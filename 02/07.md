# 7. ESM과 CommonJS의 차이점과 상호 운용

## 7.1 strict 모드에서의 ESM

- ES 모듈은 암시적으로 strict mode에서 실행된다.

## 7.2 ESM에서의 참조 유실

- ESM에서는 ES 모듈이 strict mode에서 실행되기에 require, export, module, exports, __filename, __dirname을 포함한 CommonJS의 몇 가지 중요한 참조가 정의되지 않는다.
- __filename은 현재 모듈 파일의 절대 경로, __dirname은 파일이 있는 폴더의 절대 경로를 나타낸다.
- ESM에서는 특별한 객체인 import.meta를 이용해 현재 파일에 대한 참조를 얻을 수 있다.
    - import.meta.url은 현재 모듈을 참조한다.

```js
import { fileURLToPath } from 'url'
import { dirname } from 'path'
const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)
```

```js
import { createRequire } from 'module'
const require = createRequire(import.meta.url)
```

- ES 모듈의 전역 범위에서 this는 undefined, CommonJS에선 this가 exports와 같은 참조를 하고 있다.

## 7.3 상호 운용

- ESM에서 표준 import 문법을 사용하여 CommonJS 모듈을 임포트할 수 있다.
- 하지만 default exports에 한정된다.

```js
import packageMain from 'commonjs-package'  // 작동
import { method } from 'commonjs-package'   // 에러
```

- 반대로 CommonJS에서 ES 모듈을 임포트 하는 것은 불가하다.
- 이러한 제약을 극복하기 위해 module.createRequire 유틸을 사용할 수 있다.

```js
import { createRequire } from 'module'
const require = createRequire(import.meta.url)
const data = require('./data.json')
console.log(data)
```

-----
[HOME](./index.md)
